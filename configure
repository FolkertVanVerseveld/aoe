#!/bin/bash
mode='debug'
if (( $# >= 1 )); then
	case "$0" in
		debug) mode='debug' ;;
		release) mode='release' ;;
	esac
fi
opts="$*"
case "$mode" in
	debug) opts="-g -DDEBUG $opts" ;;
	release) opts="-O2 -ffast-math" ;;
esac
dir='genie game tools'
cat <<EOF >Makefile
.PHONY: default clean $dir

default: $dir
EOF
for i in $dir; do
	printf '%s:\n\tcd %s && $(MAKE) && cd ..\n' "$i" "$i" >>Makefile
	pushd "$i" >/dev/null
	./configure $opts
	popd >/dev/null
done
printf 'clean:\n' >>Makefile
for i in $dir; do
	printf '\tcd %s && $(MAKE) clean && cd ..\n' "$i" >>Makefile
done
